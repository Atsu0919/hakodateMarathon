<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
    <link rel="stylesheet" href="plugin/L.Icon.Pulse.css" >
     
    
    <title>函館マラソンマップ</title>
</head>
<body>
    <div id="mapid" style="width: 100%; height: 500px"></div>
    <button id="btnCurLocation" onClick="setCurLocation()">現在地を表示</button>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
    <script src="plugin/L.Icon.Pulse.js"></script>
    <script src="json.js"></script>
    <script>
      var map = L.map('mapid').setView([41.768671,140.728962], 15);
      var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: "© <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors"
      });
      osm.addTo(map);
      var pulsingIcon = L.icon.pulse({iconSize:[12,12],color:'#1199fb'});
      
      function onEachFeature(feature, layer) {
      if (feature.properties && feature.properties.name) {
        layer.bindPopup(feature.properties.name);
      }
}
      var FAS=L.geoJSON(firstAid, {
        onEachFeature: onEachFeature
      });
      var firstAidStation = L.layerGroup([FAS]);
      var overlayLayerControls = {
        '救護所':firstAidStation,
      };
      L.control.layers(null, overlayLayerControls, {
        collapsed: false,
      }).addTo(map);

      var curentPosition;
      function setCurLocation(){
        
      if (curentPosition) {
        map.removeLayer(curentPosition);
      }

        if (navigator.geolocation == false){
          alert('現在地を取得できませんでした。');
          return;
        }
 
        function success(e) {
          var lat  = e.coords.latitude;
          var lng = e.coords.longitude;
          map.setView([lat, lng], );
          curentPosition = L.marker([lat,lng],{icon: pulsingIcon}).addTo(map).bindPopup('現在地').openPopup();
        };
 
        function error() {
          alert('現在地を取得できませんでした。');
        };
 
        navigator.geolocation.getCurrentPosition(success, error);
      }
      </script>
  </body>
</html>
